generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  Enable
  Disable
}

enum Status {
  Enable
  Disable
}

//
// ──────────────────────────────────────────────────────────
//   USER
// ──────────────────────────────────────────────────────────
//
model User {
  userId           String     @id @default(cuid())
  userFirstName    String
  userLastName     String
  userEmail        String     @unique
  userPassword     String
  userDepartmentId String?
  userStatus       UserStatus @default(Enable)
  userCreatedBy    String
  userCreatedAt    DateTime
  userUpdatedBy    String?
  userUpdatedAt    DateTime?

  department Department? @relation(fields: [userDepartmentId], references: [departmentId])

  createdByUser User?  @relation("UserCreatedByUser", fields: [userCreatedBy], references: [userId])
  updatedByUser User?  @relation("UserUpdatedByUser", fields: [userUpdatedBy], references: [userId])
  createdUsers  User[] @relation("UserCreatedByUser")
  updatedUsers  User[] @relation("UserUpdatedByUser")

  userRoles              UserRole[]
  userPermissions        UserPermission[]
  rolesCreated           Role[]           @relation("RoleCreatedByUser")
  rolesUpdated           Role[]           @relation("RoleUpdatedByUser")
  departmentsCreated     Department[]     @relation("DepartmentCreatedByUser")
  departmentsUpdated     Department[]     @relation("DepartmentUpdatedByUser")
  permissionsCreated     Permission[]     @relation("PermissionCreatedByUser")
  permissionsUpdated     Permission[]     @relation("PermissionUpdatedByUser")
  rolePermissionsCreated RolePermission[] @relation("RolePermissionCreatedByUser")
  rolePermissionsUpdated RolePermission[] @relation("RolePermissionUpdatedByUser")
  userRolesCreated       UserRole[]       @relation("UserRoleCreatedByUser")
  userRolesUpdated       UserRole[]       @relation("UserRoleUpdatedByUser")
  userPermissionsCreated UserPermission[] @relation("UserPermissionCreatedByUser")
  userPermissionsUpdated UserPermission[] @relation("UserPermissionUpdatedByUser")

  @@index([userCreatedBy])
  @@index([userUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   DEPARTMENT
// ──────────────────────────────────────────────────────────
//
model Department {
  departmentId        String    @id @default(cuid())
  departmentName      String
  departmentStatus    Status    @default(Enable)
  departmentCreatedBy String
  departmentCreatedAt DateTime
  departmentUpdatedBy String?
  departmentUpdatedAt DateTime?

  users         User[]
  createdByUser User?  @relation("DepartmentCreatedByUser", fields: [departmentCreatedBy], references: [userId])
  updatedByUser User?  @relation("DepartmentUpdatedByUser", fields: [departmentUpdatedBy], references: [userId])

  @@index([departmentCreatedBy])
  @@index([departmentUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   ROLE
// ──────────────────────────────────────────────────────────
//
model Role {
  roleId        String    @id @default(cuid())
  roleName      String
  roleStatus    Status    @default(Enable)
  roleCreatedBy String
  roleCreatedAt DateTime
  roleUpdatedBy String?
  roleUpdatedAt DateTime?

  userRoles       UserRole[]
  rolePermissions RolePermission[]

  createdByUser User? @relation("RoleCreatedByUser", fields: [roleCreatedBy], references: [userId])
  updatedByUser User? @relation("RoleUpdatedByUser", fields: [roleUpdatedBy], references: [userId])

  @@index([roleCreatedBy])
  @@index([roleUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   PERMISSION
// ──────────────────────────────────────────────────────────
//
model Permission {
  permissionId        String    @id @default(cuid())
  permissionName      String
  permissionKey       String    @unique
  permissionStatus    Status    @default(Enable)
  permissionCreatedBy String
  permissionCreatedAt DateTime
  permissionUpdatedBy String?
  permissionUpdatedAt DateTime?
  permissionGroupId   String?

  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  group PermissionGroup? @relation(fields: [permissionGroupId], references: [permissionGroupId])

  createdByUser User? @relation("PermissionCreatedByUser", fields: [permissionCreatedBy], references: [userId])
  updatedByUser User? @relation("PermissionUpdatedByUser", fields: [permissionUpdatedBy], references: [userId])

  @@index([permissionGroupId])
  @@index([permissionCreatedBy])
  @@index([permissionUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   ROLE ⇄ PERMISSION
// ──────────────────────────────────────────────────────────
//
model RolePermission {
  rolePermissionId           String    @id @default(cuid())
  rolePermissionRoleId       String
  rolePermissionPermissionId String
  rolePermissionStatus       Status    @default(Enable)
  rolePermissionCreatedBy    String
  rolePermissionCreatedAt    DateTime
  rolePermissionUpdatedBy    String?
  rolePermissionUpdatedAt    DateTime?

  role          Role       @relation(fields: [rolePermissionRoleId], references: [roleId])
  permission    Permission @relation(fields: [rolePermissionPermissionId], references: [permissionId])
  createdByUser User       @relation("RolePermissionCreatedByUser", fields: [rolePermissionCreatedBy], references: [userId])
  updatedByUser User?      @relation("RolePermissionUpdatedByUser", fields: [rolePermissionUpdatedBy], references: [userId])

  @@unique([rolePermissionRoleId, rolePermissionPermissionId])
  @@index([rolePermissionRoleId])
  @@index([rolePermissionPermissionId])
  @@index([rolePermissionUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   USER ⇄ ROLE
// ──────────────────────────────────────────────────────────
//
model UserRole {
  userRoleId        String    @id @default(cuid())
  userRoleUserId    String
  userRoleRoleId    String
  userRoleStatus    Status    @default(Enable)
  userRoleCreatedBy String
  userRoleCreatedAt DateTime
  userRoleUpdatedBy String?
  userRoleUpdatedAt DateTime?

  user          User  @relation(fields: [userRoleUserId], references: [userId])
  role          Role  @relation(fields: [userRoleRoleId], references: [roleId])
  createdByUser User  @relation("UserRoleCreatedByUser", fields: [userRoleCreatedBy], references: [userId])
  updatedByUser User? @relation("UserRoleUpdatedByUser", fields: [userRoleUpdatedBy], references: [userId])

  @@unique([userRoleUserId, userRoleRoleId])
  @@index([userRoleUserId])
  @@index([userRoleRoleId])
  @@index([userRoleUpdatedBy])
}

//
// ──────────────────────────────────────────────────────────
//   USER ⇄ PERMISSION  (เพิ่มใหม่ เพื่อควบคุมสิทธิ์เฉพาะบุคคล)
// ──────────────────────────────────────────────────────────
//
model UserPermission {
  userPermissionId           String    @id @default(cuid())
  userPermissionUserId       String
  userPermissionPermissionId String
  userPermissionStatus       Status    @default(Enable)
  userPermissionCreatedBy    String
  userPermissionCreatedAt    DateTime
  userPermissionUpdatedBy    String?
  userPermissionUpdatedAt    DateTime?

  user          User       @relation(fields: [userPermissionUserId], references: [userId])
  permission    Permission @relation(fields: [userPermissionPermissionId], references: [permissionId])
  createdByUser User       @relation("UserPermissionCreatedByUser", fields: [userPermissionCreatedBy], references: [userId])
  updatedByUser User?      @relation("UserPermissionUpdatedByUser", fields: [userPermissionUpdatedBy], references: [userId])

  @@unique([userPermissionUserId, userPermissionPermissionId])
  @@index([userPermissionUserId])
  @@index([userPermissionPermissionId])
  @@index([userPermissionUpdatedBy])
}

model PermissionGroup {
  permissionGroupId    String @id @default(cuid())
  permissionGroupName  String
  permissionGroupOrder Int    @default(0)

  permissions Permission[]
}
