generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Status {
  Enable
  Disable
}

enum UserStatus {
  Enable
  Disable
}

enum DeliveryStatus {
  PendingApprove
  Approved
}

model User {
  userId        String     @id @default(cuid())
  userFirstName String
  userLastName  String
  userEmail     String     @unique
  userPassword  String
  userStatus    UserStatus @default(Enable)
  userCreatedBy String?
  userCreatedAt DateTime
  userUpdatedBy String?
  userUpdatedAt DateTime?

  createdByUser User? @relation("UserCreatedByUser", fields: [userCreatedBy], references: [userId])
  updatedByUser User? @relation("UserUpdatedByUser", fields: [userUpdatedBy], references: [userId])

  createdUsers User[] @relation("UserCreatedByUser")
  updatedUsers User[] @relation("UserUpdatedByUser")

  createdDepartments Department[] @relation("DepartmentCreatedByUser")
  updatedDepartments Department[] @relation("DepartmentUpdatedByUser")

  createdDeliverys Delivery[] @relation("DeliveryCreatedByUser")
  updatedDeliverys Delivery[] @relation("DeliveryUpdatedByUser")

  createdPermissions Permission[] @relation("PermissionCreatedByUser")
  updatedPermissions Permission[] @relation("PermissionUpdatedByUser")

  createdUserPermissions UserPermission[] @relation("UserPermissionCreatedByUser")
  updatedUserPermissions UserPermission[] @relation("UserPermissionUpdatedByUser")
  userPermissions        UserPermission[]

  @@index([userCreatedBy])
  @@index([userUpdatedBy])
}

model Permission {
  permissionId        String    @id @default(cuid())
  permissionName      String    @unique
  permissionStatus    Status    @default(Enable)
  permissionCreatedBy String
  permissionCreatedAt DateTime
  permissionUpdatedBy String?
  permissionUpdatedAt DateTime?

  createdByUser User? @relation("PermissionCreatedByUser", fields: [permissionCreatedBy], references: [userId])
  updatedByUser User? @relation("PermissionUpdatedByUser", fields: [permissionUpdatedBy], references: [userId])

  userPermissions UserPermission[]

  @@index([permissionCreatedBy])
  @@index([permissionUpdatedBy])
}

model UserPermission {
  userPermissionId           String    @id @default(cuid())
  userPermissionUserId       String
  userPermissionPermissionId String
  userPermissionStatus       Status    @default(Enable)
  userPermissionCreatedBy    String
  userPermissionCreatedAt    DateTime
  userPermissionUpdatedBy    String?
  userPermissionUpdatedAt    DateTime?

  user       User       @relation(fields: [userPermissionUserId], references: [userId])
  permission Permission @relation(fields: [userPermissionPermissionId], references: [permissionId])

  createdByUser User? @relation("UserPermissionCreatedByUser", fields: [userPermissionCreatedBy], references: [userId])
  updatedByUser User? @relation("UserPermissionUpdatedByUser", fields: [userPermissionUpdatedBy], references: [userId])

  @@unique([userPermissionUserId, userPermissionPermissionId])
  @@index([userPermissionUserId])
  @@index([userPermissionPermissionId])
  @@index([userPermissionCreatedBy])
  @@index([userPermissionUpdatedBy])
}

model Department {
  departmentId        String    @id @default(cuid())
  departmentName      String    @unique
  departmentStatus    Status    @default(Enable)
  departmentCreatedBy String
  departmentCreatedAt DateTime
  departmentUpdatedBy String?
  departmentUpdatedAt DateTime?

  createdByUser User? @relation("DepartmentCreatedByUser", fields: [departmentCreatedBy], references: [userId])
  updatedByUser User? @relation("DepartmentUpdatedByUser", fields: [departmentUpdatedBy], references: [userId])

  @@index([departmentCreatedBy])
  @@index([departmentUpdatedBy])
}

model Delivery {
  deliveryId            String         @id @default(cuid())
  deliveryInvoiceNumber String         @unique
  deliveryLocation      String
  deliveryPicture       String
  deliveryStatus        DeliveryStatus @default(PendingApprove)
  deliveryCreatedBy     String
  deliveryCreatedAt     DateTime
  deliveryUpdatedBy     String?
  deliveryUpdatedAt     DateTime?

  createdByUser  User?           @relation("DeliveryCreatedByUser", fields: [deliveryCreatedBy], references: [userId])
  updatedByUser  User?           @relation("DeliveryUpdatedByUser", fields: [deliveryUpdatedBy], references: [userId])
  deliveryPhotos DeliveryPhoto[]

  @@index([deliveryCreatedBy])
  @@index([deliveryUpdatedBy])
}

model DeliveryPhoto {
  deliveryPhotoId         String            @id @default(cuid())
  deliveryPhotoDeliveryId String
  deliveryPhotoPath       String
  deliveryPhotoCreatedBy  String?
  deliveryPhotoCreatedAt  DateTime

  delivery               Delivery    @relation(fields: [deliveryPhotoDeliveryId], references: [deliveryId], onDelete: Cascade)

  @@index([deliveryPhotoDeliveryId])
}
